# 3.1 アップロード経路設計（専用線／SIM／オフラインデバイス）

この節では、車両からクラウドへのデータアップロード経路の設計について解説します。専用線・SIM 通信・オフラインデバイスなどの経路を組み合わせたバックホール構成、帯域制約下での優先度制御や再送設計、耐障害性と運用コストのバランスを議論します。データ中心・Closed-Loop の観点から、アップロード経路がボトルネックとなってデータエンジン全体のサイクルが回らなくなるリスクと、その回避策を理解することが目的です。

## バックホール容量と優先度制御

自動運転フリートからアップロードされるデータは、センサ生ログ、高頻度テレメトリ、診断情報など多岐にわたります。全てをリアルタイムに送信することは現実的ではないため、バックホール容量に応じた優先度制御 (priority control) が必要です。

典型的には、以下のようなクラス分けを行います。

- クラス A: 安全クリティカルなイベント（AEB 介入、ドライバ介入、衝突疑いなど）周辺の高解像度ログ。
- クラス B: 定期的な健全性モニタリング用テレメトリ（モデルスコア統計、データ品質指標など）。
- クラス C: 学習用途の一般走行ログ（サンプリングされたセンサデータやシナリオログ）。

データ中心・Closed-Loop の観点では、モデル改善に最も寄与するクラス A/B データを優先的にアップロードしつつ、クラス C データはオフピーク時間帯や専用拠点でのバルクアップロードに回す設計が有効であることが多いです。

実務では、SIM 通信の料金プランや帯域制限、専用線の設置コスト、デポへの帰着頻度など、多数の制約条件が存在します。そのため、バックホール設計は単に技術的な問題ではなく、ビジネス・運用とのトレードオフを含む設計問題として扱う必要があります。例えば、

- サービス初期は SIM 通信で小規模に開始し、フリート増加とともに主要拠点に専用線を引く。
- 高コストな国際ローミングを避けるため、国境をまたぐ際にはログ収集ポリシーを変更する。

といった運用が考えられます。Closed-Loop の観点からは、「どの拠点・どの経路経由のデータが、どれだけの遅延でクラウドに到達しているか」をメトリクスとして可視化し、改善サイクルのボトルネックとなっていないかを継続的に監視することが重要です。

## 再送・途中からの再開・耐障害設計

移動体通信を前提とする場合、電波状況によりアップロードが途中で中断されることが避けられません。そのため、再送 (retransmission) や途中からの再開 (resume) を考慮したプロトコルとストレージ構成が重要です。

- ログを適切なチャンク単位に分割し、各チャンクにチェックサムとシーケンス番号を付与する。
- クラウド側で受信済みチャンクを記録し、未達分のみ再送要求する。
- アップロードキューの状態を車両側で管理し、電波状態が良好なタイミングで優先度に応じて再送する。

こうした耐障害設計は、表面的にはネットワークエンジニアリングの話に見えますが、実際には「どのログがいつクラウドに到達し、いつ学習・評価に使えるようになるか」というデータエンジンのレイテンシに直結します。Closed-Loop のサイクルを短く保つためには、アップロード経路の健全性を継続的にモニタリングし、ボトルネックを可視化する仕組みが重要です。

加えて、バックプレッシャー（クラウド側の処理能力不足）に起因する遅延も考慮する必要があります。アップロード経路だけでなく、インジェストパイプラインやストレージへの書き込みレートが一時的に低下すると、車両側のアップロードキューが膨らみ、古いデータから順に破棄せざるを得ない状況が発生することがあります。これを防ぐためには、

- 車両側・クラウド側双方でキューの水位を監視し、必要に応じて一時的にトリガ頻度を下げる。
- キューから破棄する際の優先順位（低重要度データから捨てる）を明確にする。

といった制御も検討する必要があります。

## 専用線・SIM・オフラインデバイスの組み合わせ

実務では、以下のような経路を組み合わせることが多いです。

- SIM 通信: 商用モバイルネットワーク上でテレメトリや重要イベントログを随時送信します。カバレッジが広く運用が簡易ですが、帯域とコストの制約があります。
- 専用線・Wi-Fi: デポやサービス拠点に帰着した際に、大容量ログを高速にアップロードします。高スループットですが、拠点立地や設備コストが課題となることがあります。
- オフラインデバイス: 物理的にログストレージを抜き出し、拠点のサーバに接続してバルクインポートする方式です。特殊なテストキャンペーンや通信インフラが弱い地域で有用です。

データ中心・Closed-Loop の観点では、これらの経路の組み合わせを ODD とフリート運用に合わせて設計し、「重要なデータはできるだけ速くクラウドに届く」「それ以外のデータも合理的な遅延で届く」状態を目指すことが重要です。

このとき、「どのアップロード経路で送られてきたデータか」をメタデータとして記録しておくと、後続の分析やトラブルシュートに役立ちます。例えば、

- SIM 経由のデータでは一部フレームがドロップしやすい。
- 特定のデポの専用線経由データでは、時刻同期情報に欠損が多い。

などの傾向を把握し、設備増強や運用見直しにつなげることができます。

