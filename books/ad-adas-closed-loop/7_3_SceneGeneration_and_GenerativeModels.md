---
title: "7.3 走行シーン生成と生成モデルの活用"
---

# 7.3 走行シーン生成と生成モデルの活用

この節では、走行シーン生成と生成モデルの活用について解説します。生成モデルによる走行シーン生成（画像・点群・シナリオ）、実世界ログからの再現 vs 合成シーンの組み合わせ、Sim2Real / Real2Sim ギャップの評価と制御を整理し、データ中心・Closed-Loop の観点から「生成シーンをどう Closed-Loop に組み込むか」を考えます。

## 実世界ログ再現と物理ベースシミュレーション

走行シーン生成の最も基本的な手段は、「実世界ログをできるだけ忠実に再現する」ことです。第 3 章・第 4 章で扱ったように、車載センサログと高精度マップ、キャリブレーション情報が揃っていれば、シミュレータ上で以下のような再現が可能になります。

- 車両軌跡と制御入力を再現し、同じルートを仮想環境で走行させる。
- センサモデル（カメラ投影・LiDAR レイトレーシング・Radar 散乱モデルなど）を用い、実ログに近いセンサデータを再生成する。
- 他車両や歩行者の軌跡を再生し、マルチエージェント環境として再現する。

このアプローチは Real2Sim とも呼ばれ、実世界で観測された課題の再現性が高い一方で、「実世界ログに存在しないバリエーション」を作ることは得意ではありません。例えば、同じインターチェンジでの合流シーンでも、他車両の位置や速度、天候、交通量などを変えたパターンを多数生成するには、別の手段が必要になります。

## 画像・点群レベルの生成モデル

近年は、画像・動画や点群を対象とした生成モデル（GAN、VAE、拡散モデルなど）が急速に発展しており、自動運転分野でもセンサデータの合成に活用されることが増えています。代表的な活用方法としては、次のようなものがあります。

- ドメインランダマイゼーション (domain randomization): 背景、天候、照明、テクスチャなどをランダム化し、多様な見え方を持つ合成画像を生成することで、モデルのロバスト性を高める。
- ドメイン適応 (domain adaptation): 合成画像を実画像に近づける、あるいはその逆を行うことで、Sim2Real ギャップを縮小する。
- LiDAR / Radar 点群の合成: 3D オブジェクトや環境モデルから物理的に整合した点群を生成し、距離・反射強度・ノイズ特性などを模擬する。

これらの生成モデルは強力ですが、「どのような分布のシーンをどれくらい生成するか」という設計を誤ると、実世界の分布から大きく外れたデータでモデルを訓練してしまうリスクがあります。データ中心・Closed-Loop の観点では、第 4 章で扱ったデータセット設計・カバレッジ指標と整合を取りつつ、生成シーンの分布をコントロールすることが重要です。

## シナリオ・軌道レベルの生成モデル

画像や点群だけでなく、「どのような交通シーン・軌道パターンが発生するか」を生成するモデルも研究・実用化が進んでいます。代表的なアプローチとしては以下が挙げられます。

- 交通シミュレーションモデル（ミクロ交通流モデル・エージェントベースモデル）を用いたシーン生成。
- 実ログから学習した軌道生成モデル（例: GAN / VAE / Transformer ベースの trajectory generator）による他車挙動のサンプリング。
- 条件付き生成 (conditional generation) により、「合流直前に割り込みを受ける」「歩行者が突然飛び出す」など、特定のリスク要因を持つシナリオを意図的に生成する。

これらのモデルは、OpenSCENARIO などのシナリオ DSL と組み合わせることで、「論理的シナリオ → 多数の具体的シナリオ」の自動展開に利用できます。例えば、

- 論理的シナリオ: 「速度 80 km/h の本線車両と、加速車線から合流する車両。合流時ギャップは 10〜40 m。」
- 生成モデル: 交通量やドライバーアグレッシブ度をパラメータとして、多様な合流タイミング・車線変更挙動を生成。

といった組み合わせにより、実世界では頻度の低い危険なパターンも含めて体系的にテストすることができます。

## Sim2Real / Real2Sim ギャップの評価と制御

生成シーンやシミュレーションを活用する際には、Sim2Real / Real2Sim ギャップの評価と制御が重要な課題となります。ここでいうギャップとは、以下のような差異を指します。

- 視覚的な違い（テクスチャ、ノイズ、ダイナミックレンジなど）
- センサ特性の違い（ノイズスペクトル、反射特性、検出閾値）
- 交通参加者の挙動モデルの違い（人間らしさ、マナー、ランダム性）

このギャップを定量化し、許容範囲を管理するために、次のような指標や手法が用いられます。

- 実ログと合成ログの統計的比較（物体距離分布、相対速度分布、時間的相関など）。
- Perception / Prediction モデルに対する実データ・合成データの性能差の測定。
- フリート運用後のテレメトリとシミュレーション結果の分布比較（第 8 章で扱うデータドリフト検知と同様の手法）。

データ中心・Closed-Loop の観点では、「合成データを使うことでモデルが改善されたか」を常に検証し続けることが重要です。もし合成データが実世界での性能を悪化させている兆候があれば、生成モデルの分布や使用割合を見直す必要があります。

## 生成シーンを Closed-Loop に組み込む設計

最後に、生成シーンを Closed-Loop データエンジンに組み込む具体的なパターンを整理します。

- シナリオ DB との連携:
  - 生成されたシナリオも、実ログ由来のシナリオと同様にシナリオ DB に登録し、出自（合成／実ログ／ハイブリッド）をメタデータとして管理する。
  - 評価レポートでは、実シナリオと合成シナリオを区別して集計し、双方の傾向を比較する。
- データセット設計への活用:
  - 実世界データではほとんど観測されないがリスクの高い状況（例: 特定の構造物の陰からの飛び出し）に対しては、生成シーンをトレーニングデータセットに一定割合で含める。
  - 逆に、実世界で豊富に観測される一般的な状況については、合成データの比率を抑え、実データ中心とする。
- 継続的な評価とチューニング:
  - 合成データを含めたトレーニング・評価を定期的に行い、モデル性能や Sim2Real ギャップをモニタリングする。
  - 合成データが有効だったシナリオパターンを分析し、生成モデルの改良や新たなユースケースの探索に役立てる。

このように、生成モデルは「何でも増やせる魔法の道具」ではなく、「データ中心・Closed-Loop の一部として、戦略的にどの分布を補完するか」を設計して使うことが重要です。
