---
title: "3.9 データブラウザ・可視化ツール"
---

# 3.9 データブラウザ・可視化ツール

この節では、データブラウザや可視化ツールの設計について、実務的な技術要素に踏み込みながら解説します。タイムラインビュー・地図ビュー・センサー同期ビュー、モデル出力オーバーレイによるクイックレビューといった UI を、これまで第 3 章で設計してきたストレージ・メタデータ基盤とどのように接続するかを整理します。  
データ中心・Closed-Loop の観点から、人間が膨大なログとモデル挙動を直感的に理解し、エラー分析・ラベリング・安全レビューに素早くフィードバックできることが、本節の主題です。

---

## タイムラインビュー・地図ビュー・センサー同期ビュー

この小節では、Drive / Scene / Frame テーブル（3.6 節）やメタデータカタログ（3.7 節）を前提にした、「ログを横断的に読み解くためのビュー群」の技術設計を扱います。  
代表的なビューとして、タイムラインビュー、地図ビュー、センサー同期ビューがあり、それぞれがデータ中心・Closed-Loop な分析サイクルで異なる役割を担います。

### タイムラインビュー：Drive / Scene / Event の軸を揃える

タイムラインビューは、Drive（連続走行単位）や Scene（短いシナリオ単位）の時間構造を可視化し、イベント・ラベル・モデル評価結果などを時系列上に重ねて表示するビューです。  
典型的には、以下のような要素で構成されます。

- 上段: Drive 全体のタイムライン（開始〜終了）と区間ごとの Scene 区切り、運転モード（手動 / 自動）、ソフトウェアバージョン、センサー構成の変化など。  
- 中段: 特定のイベントトラック（例: AEB 介入、ドライバ介入、異常検知アラート、near-miss フラグなど）。  
- 下段: モデルスコアやテレメトリから抽出したスカラー時系列（速度、加速度、ブレーキ操作、モデル不確実性スコアなど）。

ストレージ側では、Drive / Scene / Frame テーブルに加えて、イベントテーブルやスカラー時系列テーブルを設計しておくと、この種のビューを構築しやすくなります。  
実装上は、PlotJuggler のような時系列可視化ツールをバックエンドログの閲覧に利用したり、同等の機能を内製 Web UI として実装するケースが多いです。PlotJuggler は CSV や ROS bag、ROS2 トピックなど複数ソースから時系列を取り込み、数千系列以上を高速に描画できるため、車載テレメトリやモデルスコアの確認に向いています。
Closed-Loop の観点では、オフライン評価結果や安全レビューで抽出された「要注視シーン」をタイムライン上でハイライトし、その前後の挙動をすばやくトレースできることが重要です。

技術的には、次のような点を設計しておくと運用しやすくなります。

- **マルチレゾリューションなサンプリング**: 長時間の Drive を俯瞰する表示では 1 秒〜数秒単位にダウンサンプリングし、ズームインした際にはフレーム単位の詳細表示に切り替えます。  
- **インデックス設計**: `drive_id + timestamp` でソートされたカラムナストアや、time-series DB（例: 時系列特化 DB）を用いて、任意時間範囲のクエリを数百ミリ秒以内に返せるようにします。  
- **イベント連携**: 別システムで生成された異常検知イベントやインシデントレポートと、Drive / Scene / Frame を ID で結び付け、タイムライン上にバッジとして表示できるようにします。

### 地図ビュー：軌跡・シナリオ・ODD セグメントの可視化

地図ビューは、GPS / GNSS・地図座標上で車両軌跡やシーン位置を描画し、「どこでどういうシナリオが多発しているか」を直感的に把握するためのビューです。  
多くの自動運転向けデータブラウザでは、WebGL ベースの 2D/3D 地図コンポーネント（例: Vector tile ベースの地図ライブラリ）を用い、Drive の軌跡や Scene の代表点、インシデントポイントを重ねて表示します。

典型的な機能要件としては、次のようなものが挙げられます。

- Drive の軌跡をポリラインとして描画し、クリックした位置からタイムライン・センサー同期ビューにジャンプできる。  
- シナリオタグ（例: 「ラウンドアバウト」「歩行者密集」「悪天候」）や ODD セグメント（都市高速 / 郊外 / 降雪など）をマップ上でフィルタリングし、空間的な分布やギャップを確認できる。  
- 事故・ヒヤリハット・システムダウンなどのイベントをヒートマップやクラスタとして表示し、現地調査や追加データ収集の優先度付けに活用できる。

研究用途では、Waymo Open Dataset や KITTI などの公開データセット向けに、軌跡や 3D 点群・カメラ画像を地図と一緒に可視化するためのツールが公開されています。例えば OdoViz は、GPS/INS の軌跡と点群・画像を Web ベースで可視化し、複数の走行軌跡を比較する機能を持つツールです。自社システムでも、同様の構成（軽量なサーバ + リッチな Web クライアント）を採用するケースが多いです。

ストレージ・スキーマとの関係では、

- 座標系（地図座標 vs 車両座標 vs センサ座標）の統一と、`drive_id / scene_id / frame_id` ごとに位置情報を正規化しておくこと。  
- ODD セグメントや道路種別（高速 / 一般道 / 私道など）、法規制情報（制限速度、優先道路、横断歩道位置など）を属性としてメタデータ化しておくこと。  
- 地図ビューから直接クエリを投げて、該当するシーンの一覧を取得し、4 章の「シーン検索 UI」や 5 章のラベリングツールに引き渡せるようにすること。

といった点が重要になります。

### センサー同期ビュー：マルチモーダル再生と同期精度

センサー同期ビューは、カメラ・LiDAR・Radar・IMU・CAN・高精度地図など、複数のセンサストリームを時間同期させて再生するビューです。  
ROS ベースの開発では RViz / RViz2 が標準的な 3D センサー可視化ツールとして利用されており、トピックと TF ツリーを設定することで、LiDAR 点群・カメラ画像・座標系変換・ロボット姿勢などを一括で表示できます。近年は、Foxglove Studio のように、タイムライン・3D ビュー・地図ビュー・プロットを同一 UI 内で組み合わせて扱えるツールも広く利用されています。
また、PlotJuggler のような時系列可視化ツールを併用し、センサー同期ビューと連動した数値プロット（速度・制御指令・センサヘルス指標など）を表示する構成も一般的です。

センサー同期ビューを安定して運用するためには、3.3 節で議論した時刻同期・タイムスタンプ整合が前提となります。実装上の要点は次の通りです。

- **統一された「再生時計」**: UI 側に再生時間（playback time）の概念を持たせ、その時刻に最も近いフレームを各センサストリームから選択して表示します。サーバ側で補間・リサンプリングしたフレーム列を用意しておくと、クライアント実装を簡素化できます。  
- **帯域制限とストリーミング**: フル解像度のセンサデータをそのまま Web クライアントに送ると帯域・レイテンシの面で現実的ではないため、プレビュー用の縮小画像やダウンサンプリングした点群を事前生成し、UI からの要求に応じて配信する設計がよく用いられます。  
- **シーク性能**: 「問題が発生した直前の 10 秒〜直後の 10 秒」を繰り返し行き来する使い方が多いため、オブジェクトストレージ上のフレーム群をシークしやすいレイアウト（固定長ブロック単位のシャーディングなど）にしておくと快適です。

自動運転向けの研究ツールでも、Waymo Open Dataset 向けの 3D ビューアや、KITTI / Waymo の 3D 検出・追跡結果をインタラクティブに可視化するツールが公開されています。例えば、3D-Detection-Tracking-Viewer は、KITTI / Waymo の 3D ボックス・点群・カメラ画像を 2D/3D で連動表示するためのビューワです。
自社システムでも同様に、センサー同期ビューを「Drive 内の任意フレームを即座に再生できる汎用ビューワ」として設計し、ラベリングツールやモデル評価 UI と共通コンポーネント化しておくと、Closed-Loop 全体で保守性が高まります。

---

## モデル出力オーバーレイによるクイックレビュー

この小節では、モデル出力（検出ボックス、セマンティックマスク、予測軌道、計画軌道、占有グリッドなど）をセンサー映像や BEV 表現にオーバーレイ表示し、誤検出・検出漏れ・異常挙動を素早くレビューするための仕組みを解説します。  
データ中心・Closed-Loop の観点では、オフライン評価・シミュレーション・実運用モニタリングで得られたモデル挙動を、ラベルやメタデータと一体で確認できることが、改善サイクルの速度と質を左右します。

### 2D / 3D ラベルとモデル出力の整合

Waymo Open Dataset などの大規模データセットでは、LiDAR 3D ボックスや 2D ボックス・キーポイント・動画パノプティックセグメンテーションなど、マルチモーダルなラベルが整備されています。これらのデータセットの可視化ツールやチュートリアルでは、3D ボックス・点群・カメラ画像・マップ情報を一体として表示するために、センサキャリブレーション（内外部パラメータ）を元に座標変換と投影を行っています。

自社のデータブラウザでも、同様の考え方で以下を設計する必要があります。

- **データモデル**: `frame_id` ごとに、「センサ生データ」「ラベル」「モデル出力」を紐付けるテーブルを用意し、同一座標系（例: 車両座標系やワールド座標系）で表現します。LiDAR ベースの 3D ボックスは車両座標系で保持し、カメラ画像へのオーバーレイ時に射影する、という構成が典型的です。  
- **複数モデルバージョンへの対応**: 同一フレームに対して、異なるバージョンの perception / prediction / planning モデルの出力を複数保持するために、`model_run_id` や `experiment_id` をキーとした別テーブルを設けます。UI 側では、チェックボックスやドロップダウンでモデルバージョンを切り替えられるようにします。  
- **ラベルとの整合性**: Ground truth ラベルとモデル出力を同時に表示し、TP / FP / FN を色分けするためのマッチングロジック（IoU ベースのマッチングなど）をサーバ側で事前計算しておくと、UI は軽量になります。

3D ビューア実装の例としては、前述の 3D-Detection-Tracking-Viewer のように、KITTI / Waymo の 3D ボックスや点群を 2D/3D で切り替え表示できるツールが公開されています。これらは、カメラ画像への投影・3D 空間でのボックス表示・トラッキング ID の描画などを一括で扱っており、自社のビューワ設計の参考になります。

### クイックレビュー UI とインタラクション設計

モデル出力オーバーレイによるクイックレビューは、「1 シーンあたり数十秒〜数分以内で、何が問題かを把握する」ことを目標とした UI です。技術的には次のようなインタラクションがよく採用されます。

- **オブジェクト単位のインタラクション**: ボックスやセグメントをクリックすると、そのオブジェクトのトラック ID、クラス、信頼度スコア、速度ベクトル、過去・未来の軌跡などをツールチップで表示します。トラックを選択した状態でタイムラインを再生すると、そのオブジェクト周辺のシーンが強調表示されます。  
- **誤りタイプ別の強調表示**: FP（誤検出）は赤、FN（検出漏れ）は黄色、TP は緑といった色分けを行い、誤りタイプごとの空間的・時間的分布がひと目で分かるようにします。  
- **モデル間比較**: ベースラインモデルと新モデルを A/B 切り替え、もしくは透過度を変えて重ねて表示し、「どのシーンでどのような改善・退行があったか」を視覚的に確認します。  
- **ビューシンクロ**: タイムライン上のカーソル位置と、地図ビュー・センサー同期ビューの再生位置を連動させ、問題の瞬間に素早くジャンプできるようにします。

こうしたインタラクションは、ツールの種類に依存しません。例えば、RViz ではカスタムプラグインを用いて 3D ボックスや軌跡を描画し、PlotJuggler で時系列スコアを確認する構成がよく用いられます。 あるいは Foxglove Studio のような統合ツールでは、タイムライン・3D ビュー・2D プロットを一つのレイアウトにまとめ、クリック操作で同期させることが可能です。
重要なのは、特定のツールを選ぶことよりも、「Drive / Scene / Frame / model_run_id / label_version」といったキーを軸として、どのツールからでも同じコンテキストにジャンプできる情報設計を行うことです。

### Closed-Loop における活用パターン

モデル出力オーバーレイは、Closed-Loop データエンジンの各段階で次のように活用されます。

- **オフライン評価（第 6 章）**: 新モデルの評価結果を集計したあと、代表的な成功例・失敗例を可視化ツールでレビューします。メトリクスだけでは見えにくい挙動（例: 渋滞での微妙な車間調整、歩行者の微妙な挙動への反応など）を人間が確認する場面です。  
- **シミュレーション / シナリオ検証（第 7 章）**: シミュレータ上で生成したシナリオやログリプレイに対して、モデル出力をオーバーレイし、シナリオごとの挙動を確認します。シナリオテンプレートに基づく回帰テストの結果を「シナリオ一覧 → 問題シーン → オーバーレイ表示」という流れで辿れると、テスト効率が向上します。  
- **実運用モニタリング（第 8 章）**: 運用中に検出されたインシデントや near-miss に対して、自動で該当シーンを抽出し、関係者がオーバーレイつきでレビューできるようにします。ここでのフィードバックは、次のラベリング・再学習サイクルに直接つながります。

データ中心の観点では、「どのシーンがどの理由で問題と判断されたか」「そのシーンはどのような属性（天候・時間帯・道路種別・他エージェント構成など）を持つか」を、可視化ツールから直接読み取れることが重要です。  
例えば、オーバーレイ閲覧画面からワンクリックで「同様のシーンを検索」（4.7 節の Embedding ベース類似シーン検索など）に飛べるようにし、その結果を新たな学習・評価データセットとして収集する、というループを構築できます。こうした UI レベルの工夫が、そのまま Closed-Loop の回転速度とカバレッジ拡大に直結します。

最後に、ツール選定については、オープンソースの一般用途ツール（RViz, PlotJuggler 等）、自社内製 Web ビューア、商用の統合可視化サービスなど複数の選択肢がありますが、本書では特定のツールを推奨することが目的ではありません。重要なのは、どの選択肢を取ったとしても、

- Drive / Scene / Frame / Event / model_run / label_version といったキーでストレージ・カタログ・可視化を一貫して連携させること  
- オフライン・シミュレーション・実運用の各段階から、容易にオーバーレイビューにジャンプできる情報設計を行うこと  
- 新しいツールやビューを追加しても、既存のメタデータスキーマと整合性を保てるようにすること

という 3 点を満たすことです。こうした設計を通じて、データブラウザ・可視化ツールは、単なるデバッグ用 UI を超え、データ中心・Closed-Loop な自動運転開発を支える中核コンポーネントとなります。

