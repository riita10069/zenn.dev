---
title: "8.5 実運用モニタリングと異常検知"
---

# 8.5 実運用モニタリングと異常検知

この節では、実運用モニタリング (online monitoring) と異常検知について解説します。テレメトリ・モデルメトリクス・環境分布の監視、データドリフト・コンセプトドリフトの検知、オンライン安全監視（安全マージン・介入頻度）を整理し、データ中心・Closed-Loop の観点から「運用中に得られるシグナルを次の改善サイクルにどう渡すか」を考えます。

## 実運用モニタリングの目的とレイヤ

実運用モニタリングの目的は、大きく分けて次の 3 点に整理できます。

- システム健全性 (system health) の監視  
  - ECU の CPU 使用率、メモリ・ストレージ残量、温度、通信品質など。
- モデル挙動 (model behavior) の監視  
  - 推論レイテンシ、出力分布、信頼度スコア、異常な出力パターンなど。
- 安全・運転品質 (safety & quality) の監視  
  - 介入頻度、AEB 作動回数、ヒヤリハット指標、乗り心地（加速度・ジャーク）など。

これらは単独で監視するのではなく、「どのような環境条件・ODD セグメントで、どのソフトウェア・モデルバージョンが、どのような挙動を示しているか」をクロスで分析できる形で収集することが重要です。例えば、「特定地域の夜間雨天において、特定バージョンの perception モデルで介入率が増加している」といったパターンを早期に検出できれば、データ収集・再学習の優先順位付けに直接つながります。

## テレメトリ設計と収集すべきシグナル

実運用モニタリングの基盤となるのがテレメトリ (telemetry) です。テレメトリは「どのくらい走ったか」といった露出量 (exposure) の把握から、「どのようなイベントが発生したか」といった詳細なログまで幅広く含みます。一般的には次のような粒度で設計します。

- 集約テレメトリ (aggregated telemetry)  
  - 車両単位・日単位で集計された走行距離、運転時間、介入回数、AEB 作動回数など。  
  - 軽量で送信コストが低く、フリート全体の傾向把握に有用。
- イベントテレメトリ (event telemetry)  
  - 介入、急ブレーキ、衝突警報などのイベントが発生した瞬間の前後数秒〜数十秒の詳細ログ。  
  - センサー出力、モデル出力、制御コマンドを含み、後述するインシデント分析や再学習データとして利用。
- コンテキストメタデータ  
  - ODD セグメント情報（地域、道路種別、天候、時間帯）、ソフトウェア・モデルバージョン、車両属性など。

テレメトリの設計では、プライバシー・通信コスト・ストレージコストとのトレードオフを意識する必要があります。全センサデータを常時アップロードすることは現実的ではないため、「どのような条件で詳細ログを収集するか」「どの程度の頻度で集約統計を送信するか」を明確に決め、8.6 節で扱うインシデント収集や 4 章のデータ選択と整合を取ることが重要です。

## モデルメトリクスとオンライン評価

運用中のモデルの性能を推し量るためには、「オンラインで観測可能なモデルメトリクス (model metrics)」を設計します。教師ラベルがない運用環境では、典型的な精度指標（mAP など）を直接計算することはできませんが、代わりに次のような指標が利用されます。

- スコア分布・信頼度の統計  
  - クラス確率のヒストグラム、最大スコアの分布、エントロピーなど。  
  - 過去のベースラインと比較し、「全体的に信頼度が低下していないか」「特定クラスの出現頻度が急増していないか」を確認。
- シャドウモデル・チャンピオン / チャレンジャーモデル  
  - 本番では 1 つのモデルの出力のみを車両制御に用いるが、バックグラウンドで別バージョンのモデルも同じ入力に対して推論を行い、出力を比較する。  
  - ラベルがなくても、「モデル間の不一致率」や「安全側へのバイアスの違い」を指標としてモニタリング可能。
- 近接センサー・冗長システムとの整合性  
  - Radar と Camera の出力を比較し、一致しないケースの割合を監視する。  
  - 地図・V2X 情報と認識結果の整合性をチェックする。

オンライン評価の結果は、8.2 節で定義したリリースゲートを補完する「運用時の追加ゲート」としても活用できます。例えば、「新バージョンを適用したカナリア車両群で、一定距離あたりの AEB 作動回数がベースラインより有意に増加した場合、自動的にロールバックする」といったルールを設計できます。

## データドリフト・コンセプトドリフトの検知

データドリフト (data drift) は入力分布の変化、コンセプトドリフト (concept drift) は「入力と正解の関係」の変化を指します。自動運転・ADAS の文脈では、

- 新しい道路インフラや標識デザインの導入
- 交通環境の変化（電動キックボードの増加、新たな交通ルール）
- センサーの経年劣化やキャリブレーションずれ

などによって、運用環境が徐々に変化していくことが多いです。これらを早期に検出するために、データドリフト・コンセプトドリフトの検知手法をオンラインモニタリングに組み込みます。

代表的なアプローチとしては、以下が挙げられます。

- 特徴量分布の統計比較  
  - オフラインで構築した基準分布と、最新の運用データの分布を比較し、PSI (Population Stability Index) や KL ダイバージェンスなどの指標を計算する。  
  - しきい値を超えた場合、該当 ODD セグメントでのデータ収集・再学習を検討する。
- 埋め込み空間でのドリフト検知  
  - モデルの中間特徴量（embedding）を用い、クラスタ構造や距離分布の変化を監視する。  
  - 4.8 節で扱ったアクティブラーニングの仕組みと組み合わせ、異常なクラスタからサンプルを優先的に取得・ラベル付けする。
- 疑似ラベルやマルチモデル比較によるコンセプトドリフト検知  
  - 同一入力に対する異なるモデルの出力差分や、連続フレーム間での予測一貫性を指標とし、「モデルが自信を失っている領域」を検出する。

ドリフト検知の結果は、「単なるアラート」で終わらせるのではなく、4 章のデータ選択・5 章のラベリング・6 章の再学習に接続するトリガとして活用します。例えば、「特定都市の夜間シーンで pedestrian 検出に関するドリフトが検知された場合、そのセグメントのデータを優先して再ラベル・再学習キューに投入する」といった運用が考えられます。

## 異常検知と安全モニタ

異常検知 (anomaly detection) は、ドリフト検知よりも局所的・瞬間的な挙動に着目します。自動運転では、次のような観点で異常検知を設計します。

- 車両ダイナミクスの異常  
  - 瞬間的に非常に大きな加速度・ジャークが生じていないか。  
  - 車線中心からのオフセットが急激に変化していないか。
- モデル出力の異常  
  - カメラ画面全体が「不明クラス」になる、突然検出オブジェクト数がゼロになるなど、明らかに不自然な出力。  
  - 連続フレーム間の出力が物理的にあり得ないほど変化している。
- センサー・システムの異常  
  - 特定センサーの信号が突然途絶える、ノイズが急増する。  
  - 内部エラーコードやウォッチドッグタイマの発火。

これらの異常検知は、「安全モニタ (safety monitor)」や「セーフティケージ」と呼ばれる独立したモジュールとして実装されることが多いです。安全モニタは、メインの自動運転スタックとは別系統で動作し、異常を検知した際には、

- ドライバに警告を出す（警告音・ディスプレイ表示など）。
- 自動運転機能を停止し、人間運転に切り替える。
- 必要に応じて、段階的減速や路肩退避といった「最小リスク状態 (minimum risk condition)」への移行を行う。

データ中心・Closed-Loop の観点では、これらの異常検知イベントをすべてテレメトリとして送信し、8.6 節で扱うインシデント・ヒヤリハット収集と統合することが重要です。これにより、「どのような異常がどの ODD で、どのモデルバージョンで頻発しているか」を把握し、データ収集・モデル改善を優先度付けできます。

## Closed-Loop へのフィードバック

実運用モニタリングと異常検知の最終的な目的は、「運用で得られたシグナルを次の改善サイクルに活かすこと」です。Closed-Loop の観点からは、次のような流れを設計します。

1. 8.5 節で述べたテレメトリ・ドリフト検知・異常検知が、運用環境から継続的にシグナルを送信する。
2. そのシグナルに基づき、4 章のデータ選択・5 章のラベリングキューに優先度付きのサンプルが追加される。
3. 6 章のモデルトレーニングで、これらのサンプルを含んだ新たなデータセットバージョンが設計され、モデルが再学習される。
4. 7 章のシミュレーション・テストおよび 8.2 節のリリースゲートで、新モデルが十分に評価される。
5. 8.3〜8.4 節で述べた CI/CD・OTA を通じて、新モデルが限定的にデプロイされ、その効果が再びオンラインモニタリングによって観測される。

このループが確立されていれば、運用環境で新たに発生したリスクやロングテールシナリオが、時間差はあっても必ずデータとして開発側に戻り、モデルとシステムの改善につながっていきます。実務では、これらの流れを「監視ダッシュボード」「インシデント管理システム」「データブラウザ」といったツール群で可視化し、エンジニア・運用・安全担当が共通の状況認識を持てるようにすることが重要です。

