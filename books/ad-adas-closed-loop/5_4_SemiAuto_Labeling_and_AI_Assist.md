# 5.4 半自動ラベリング・AI アシストツール

この節では、半自動ラベリング (semi-automatic labeling) と AI アシストツールについて解説します。事前モデルによるプリラベルと人間による修正、反復学習ループ（モデル → ラベル提案 → 修正 → 再学習）を整理し、データ中心・Closed-Loop の観点から「人と AI の協調によるラベル作成効率化」を考えます。

## プリラベルと人手修正

既存モデルや簡易検出器を用いて、未ラベルデータに対して自動的にラベル候補を付与し、人間のアノテータがそれを確認・修正するワークフローは広く用いられています。この方式では、完全な手動ラベリングに比べて工数を大幅に削減できる一方、プリラベルのバイアスが残るリスクもあります。

## 反復学習ループと難例マイニング

Closed-Loop の観点では、「現行モデルでプリラベル → 人手修正 → 再学習 → モデル改善 → 新たな難例発見」というループを継続的に回すことが重要です。難例やプリラベルの誤りが集中しているシーンを特定し、次のデータ収集・ラベリング戦略に反映することが求められます。

## プリラベルモデルの設計と評価

プリラベルに用いるモデルは、本番運転中のオンラインモデルと同一である必要はありません。むしろ、オフラインで重いモデルやアンサンブル (ensemble) を使い、高精度な候補ラベルを生成するほうが効率的なことが多いです。Waymo Open Dataset などの大規模データセットでは、オフラインの 3D 検出・トラッキングパイプラインを用いて高品質なラベルを生成し、その後に人手でチェック・修正している例が報告されています。

プリラベルモデルを設計する際のポイントは次の通りです。

- **リコール重視か精度重視かのトレードオフ**  
  「候補漏れが少ないが FP が多い」モデルと、「候補は少ないがほぼ正しい」モデルのどちらを採用するかは、アノテーションコスト構造によって変わります。一般に、自動車の安全に関わるクラス（歩行者、二輪車など）はリコール重視とし、FP の確認負荷を受け入れる設計が多いです。
- **信頼度スコアとしきい値**  
  出力スコアをそのままアノテータに見せ、「0.9 以上はほぼ正しい」「0.5〜0.7 は注意して確認する」といった運用ルールを決めます。FixMatch などの半教師あり学習で使われる pseudo-labeling のしきい値設計と発想は近いです。
- **マルチタスク・マルチセンサの活用**  
  3D LiDAR 検出結果を 2D ビューに投影したり、HD マップから車線や信号の候補を取得してプリラベルに使うことで、人手作業をさらに減らすことができます。

プリラベルモデル自体も Closed-Loop の一部であり、人手修正結果を用いて継続的に更新していくことで、ラベル提案の精度と生産性を改善できます。

## アクティブラーニングとの組み合わせ

半自動ラベリングは、アクティブラーニング (active learning) と組み合わせることで、より効率的なデータ収集・ラベル付けが可能になります。典型的なループは次のようなものです。

1. 現行モデルでフリートログ全体を推論し、不確実度 (uncertainty) や予測エラーをスコアリングする。
2. スコアの高いフレーム・シーンをラベリングキューに優先的に投入する。
3. プリラベルモデルで候補ラベルを生成し、人手で修正する。
4. 新しいラベルを反映してモデルを再学習し、不確実度分布の変化をモニタリングする。

これにより、「モデルがすでによく理解しているシーン」ではなく、「まだ苦手としている長尾のシーン」にラベリングリソースを集中させることができます。アノテーションツール側には、不確実度スコアやヒートマップを表示する機能があると、このループを直感的に運用できます。

## ツール内での AI アシスト UX 設計

AI アシストは、単に自動ラベルを表示するだけでなく、アノテータにとって扱いやすいユーザー体験 (UX) を設計することが重要です。

- **一括承認・一括却下操作**  
  同一シーン内の低リスクな候補（例えば、遠方の車線境界など）については、一括承認ボタンで素早く処理できるようにします。一方で、歩行者や近距離車両など安全クリティカルなラベルは、個別確認を必須とする設定が考えられます。
- **提案理由の可視化 (explainability)**  
  どのセンサ情報や特徴量に基づいてラベル提案を行ったのかを、簡易な形でもよいので可視化すると、アノテータがモデルの癖を理解しやすくなります。Grad-CAM 的な可視化や、マップ上の参照ポイント表示などが例です。
- **フィードバックチャンネル**  
  アノテータが「この種の提案はほぼ毎回間違っている」「この条件では提案しないでほしい」といったフィードバックをツール上から送信できる機能を設けます。これを統計的に集計し、プリラベルモデルやしきい値設計の改善に活かします。

Closed-Loop の観点では、AI アシストで得られた「提案と最終ラベルの差分」こそが貴重な学習データです。差分を体系的に収集・分析し、「どのシナリオでモデルが系統的に誤るか」を可視化することで、次のデータ収集・ラベルポリシー改善・モデル改善のサイクルを加速できます。
