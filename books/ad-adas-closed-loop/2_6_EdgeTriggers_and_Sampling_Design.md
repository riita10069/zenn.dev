---
title: "2.6 エッジトリガー構成・記録開始条件・サンプリング設計"
---

# 2.6 エッジトリガー構成・記録開始条件・サンプリング設計

この節では、どのタイミングでどのデータを記録するかを決めるエッジトリガー (edge trigger) 構成とサンプリング設計について解説します。常時録画とイベントトリガのトレードオフ、低レートテレメトリと高解像度生センサの役割分担、リモートからのトリガ設定変更の考え方を整理します。データ中心・Closed-Loop の観点から、限られたストレージ・通信リソースの中で、モデル改善に最も有用なデータを効率よく収集する方法を考えます。

## 常時録画 vs イベントトリガ

理想的には、全てのセンサデータを常時録画 (always-on logging) できれば、後からあらゆる分析に利用できます。しかし、ストレージと通信帯域には現実的な制約があるため、多くのシステムではイベントトリガ (event-triggered logging) を併用します。

- 常時録画: 一定期間分のリングバッファとしてデータを保持し、重要なイベントが発生した場合にその前後を保存する方式です。長時間の詳細ログが必要な FOT 車両などで用いられます。
- イベントトリガ: 急制動、AEB 介入、警告発生、ドライバ手動介入など、特定の条件を満たしたときにログ保存を開始する方式です。量産フリートでの運用に適しています。

データ中心の観点では、「どのイベントをトリガにするか」「トリガ前後のどれくらいの期間を保存するか」を慎重に設計することで、ロングテールなヒヤリハットシーンを効率よく収集できます。Closed-Loop では、オンラインモニタリングやオフライン分析の結果に基づいて、トリガ条件を継続的にチューニングしていくことが重要です。

### イベント種別としきい値設計

イベントトリガの代表的な種別として、次のようなものがあります。

- 車両運動ベース: 減速度・ヨーレート・横加速度などがしきい値を超えた場合（急ブレーキ・急ハンドル）。
- ADAS/AD 介入ベース: AEB・LKA・ACC の強制介入やドライバの急なテイクオーバー。
- モデル挙動ベース: モデルの不確実性スコアが高い、もしくは出力が異常と判定された場合。
- 環境ベース: 特定の天候・時間帯・位置（例: 雪道、高速 IC 周辺、踏切）に入ったこと自体をトリガとする。

しきい値設計では、「頻度が高すぎて帯域を圧迫しないか」「低すぎて重要なシーンを取り逃がさないか」のバランスを取る必要があります。データ中心・Closed-Loop の観点では、イベント発生率を継続的にモニタリングし、「1,000 km あたりのイベント件数」「ODD セグメントごとのイベント密度」などを指標として、しきい値調整の効果を評価することが重要です。

### トリガ前後ウィンドウと情報量

イベントトリガで保存する前後ウィンドウの長さ（例: 前 20 秒／後 30 秒）は、解析や学習に必要な文脈量と、ストレージ・帯域制約のトレードオフで決まります。

- 短すぎると、イベントに至るまでのコンテキスト（前方車との相対速度変化、歩行者の出現タイミングなど）が失われます。
- 長すぎると、1 件あたりのデータ量が増え、他のイベントを収集する余地が減ります。

実務では、まずは保守的に長めのウィンドウを設定し、オフライン分析から「実際に解析に使っている時間範囲」を測定したうえで、段階的に削減していく方法が現実的です。また、前後ウィンドウの長さをイベント種別ごとに変える（例えば AEB 介入は長め、軽微な警告は短め）といった工夫も考えられます。

## 低レートテレメトリ vs 高解像度生センサ

フリート全体からクラウドにアップロードできるデータ量には限りがあるため、低レートのテレメトリ (telemetry) と、高解像度の生センサログの役割分担を設計する必要があります。

- 低レートテレメトリ: 車速、操舵角、加速度、警告フラグ、モデルのスコアなどを数百ミリ秒〜数秒程度のレートで送信するデータです。広範なフリートから継続的に収集でき、分布変化やドリフトの検知に適しています。
- 高解像度生センサ: カメラ画像や LiDAR 点群など、大容量だがリッチな情報を含むデータです。主にヒヤリハットやモデル失敗シーンの詳細分析や再学習に用いられます。

Closed-Loop の観点では、テレメトリから異常挙動や分布変化を検知し、その周辺の生センサデータを高優先度でアップロードするような設計が有効です。このように、テレメトリと生センサを組み合わせることで、限られた帯域の中でモデル改善に必要なデータを確保できます。

### テレメトリ項目の設計

テレメトリとして送るべき項目は、必ずしも車両 ECU の全信号ではなく、「Closed-Loop を回すうえで有用な要約情報」です。代表的な例として、次のようなものが挙げられます。

- 走行環境の要約: ODD セグメント ID（都市／郊外／高速／降雪など）、天候、時間帯。
- モデル挙動の要約: 検出件数・検出密度、不確実性スコアの統計、制御出力の分布。
- 安全関連指標: 介入フラグ、最小 TTC (time-to-collision)、横方向の安全マージン。

テレメトリ設計では、「これらの指標だけを見て、どの ODD・どのバージョンに問題があるかを概ね特定できるか」を一つの目安とすると良いです。そのうえで、問題のありそうな領域について、追加で生センサログを取得・解析していきます。

### サンプリング戦略と代表性

低レートテレメトリは「ほぼ全走行をカバーする代表性」、高解像度生センサログは「限定的だが詳細な情報」という役割を持ちます。データ中心・Closed-Loop の観点では、両者を組み合わせて次のような戦略を取ることが多いです。

- テレメトリに基づき、ODD セグメントごとの走行量とインシデント率を可視化し、「どこでデータが不足しているか」「どこで性能が足りていないか」を把握する。
- 不足している ODD／シナリオについては、イベントトリガやリモート指示により、意図的に生センサログを多めに収集する。

このように、サンプリング設計は「代表性を担保するテレメトリ」と「重点的に集める生センサ」の二層構造として設計されます。

## リモートからのトリガ設定変更

運用が進むにつれて、「どのイベントが重要か」「どのようなシーンをもっと集めるべきか」は変化していきます。そのため、クラウド側からフリートに対してトリガ設定をリモート更新できる仕組みを用意しておくことが望ましいです。

例えば、以下のようなユースケースが考えられます。

- 特定地域・特定バージョンの車両に対して、一時的に「雨天時の交差点右折シーン」を重点的に収集するトリガを配信する。
- 新しいモデルを A/B テスト中の車両に対して、そのモデルが低信頼度を出力したシーンを優先的にアップロードさせる。

データ中心・Closed-Loop の観点では、トリガポリシー自体を実験の一部として捉え、「どのトリガ構成が最も効率よくモデル改善に寄与したか」を振り返ることが重要です。そのために、トリガ設定のバージョンと収集されたデータの関係をメタデータとして管理することを推奨します。

### トリガポリシーのバージョニングと実験設計

トリガ設定そのものがモデル改善実験の一部である、という視点に立つと、トリガポリシーにもバージョンを付与し、A/B テストのように比較することができます。

- ポリシー A: 急ブレーキ + 介入 + AEB 作動のみをトリガとする。
- ポリシー B: 上記に加えて、「モデル不確実性が高いシーン」をトリガに含める。

ポリシーごとに、1,000 km あたりの収集データ量、Long-tail セットでの性能改善量、帯域・ストレージ使用量などを指標として比較することで、「どのトリガ構成が最も効率的か」を定量的に評価できます。第 4 章のアクティブラーニングの議論とも接続しながら、「どのシーンをどのような基準で選ぶか」をトリガレベルから設計していくことが重要です。

### ODD／機能別トリガポリシー

全ての車両・全ての ODD で同じトリガポリシーを適用する必要はありません。むしろ、以下のように ODD や機能ごとにトリガを変える方が効率的なことが多いです。

- 高速道路 ODD: 前方衝突リスクや合流・車線変更に関連するイベントを重視。
- 都市部 ODD: 横断歩道・右折時歩行者・自転車との関係を重視。
- 新機能リリース直後: その機能が関わるイベント（例: 特定の自動駐車モード）を優先的に収集。

Closed-Loop データエンジンでは、「どの ODD でどのトリガポリシーが走っていたか」を時系列で追跡できるようにし、新旧ポリシーの差分がモデル性能やインシデント統計にどう効いているかを定期的にレビューすることが望ましいです。

