# 4.9 合成データと生成モデルの位置づけ

この節では、不足シーン補完のための合成データ (synthetic data) と生成モデルの活用について解説します。現実データ vs シミュレーション・生成シーンのトレードオフ、第 7 章で扱うシミュレーション・シナリオ生成との関係を整理し、データ中心・Closed-Loop の観点から合成データをどのように位置づけるかを考えます。

## 不足シーン補完としての合成データ

実世界では収集が難しい危険シナリオや、特定の ODD 条件（濃霧、豪雪など）における十分なデータを得るため、シミュレータ上で合成データを生成するアプローチが一般的です。これにより、ロングテールなシーンをコントロールしながら増やすことが可能になります。

代表的な合成データ源としては、

- ドライビングシミュレータ（CARLA, LGSVL/SVLSim, BeamNG.tech 等）による物理ベースの合成。
- CG ツールやゲームエンジン（Unreal Engine, Unity 等）を用いたオフラインレンダリング。
- 画像・動画生成モデル（GAN, diffusion model 等）による外観変換やシーン生成。

があります。これらのツールはそれぞれ特性が異なり、物理的整合性・レンダリング品質・シナリオ制御性・生成コストなどの観点で使い分ける必要があります。本書では特定ツールに依存しませんが、「どの程度物理的に正確である必要があるか」「どのタスクの学習に使うか」という観点から、適切なレベルのシミュレーション・生成を選択することが重要です。

## 生成モデルによるデータ拡張とシーン変換

近年は、生成モデル (generative model) を用いて実データを変換し、新たなバリエーションを生成する手法も広く研究されています。

- スタイル変換：晴天 → 雨・雪・夜間への天候・時間帯変換。
- Domain Randomization：テクスチャ・照明・背景をランダムに変化させ、ロバスト性を高める。
- セマンティックレベルの編集：車線数や標識配置、歩行者数などを変更したシーン生成。

これらの手法は、完全に人工的なシーンをゼロから生成するのではなく、「実世界の幾何・トラフィック構造は保持しつつ、外観や細部を変化させる」ことで、Sim2Real ギャップを小さく保ちながらデータ多様性を増やすことを狙います。例えば、実世界ログから抽出した合流シーンを、生成モデルで「雨・夜・霧」など様々な条件に変換し、Perception / Planning モデルのロバスト性向上に利用することが考えられます。

## 現実データとのバランスと Sim2Real ギャップ

合成データはラベル付けコストが低く柔軟ですが、現実データとの分布差（Sim2Real ギャップ）が大きい場合、モデルが実世界で期待通りに動作しないリスクがあります。Closed-Loop の観点では、現実データと合成データの比率や役割分担を慎重に設計し、シミュレーションで得られた知見をどのように実車データ収集・評価にフィードバックするかを明確にすることが重要です。

合成データと現実データのバランスを設計する際には、少なくとも次の点を検討します。

- Perception 用：合成データはラベルが正確で背景・ライティングも制御可能ですが、センサノイズやレンズ効果などの細部に差が出やすいです。ドメインギャップを緩和するために、Domain Adaptation / Domain Randomization を併用することが多いです。
- Prediction / Planning 用：他車・歩行者の挙動モデルが現実世界とどの程度一致しているかが重要です。合成シーンで学習したポリシーを実世界に適用する際には、実車データでの微調整やオフラインログリプレイによる検証が必須になります。

Sim2Real ギャップの評価には、

- 同一シナリオを実世界とシミュレータの両方で再現し、Perception / Planning 指標を比較する。
- 合成データで学習したモデルを実世界の評価セットに適用し、現実データのみで学習したモデルとの性能差を測る。

といった手法が用いられます。差分が大きい領域については、現実データの収集や合成データ側の改良（センサモデルの改善、テクスチャの現実感向上など）を行い、Closed-Loop にギャップを縮小していきます。

## 合成データ・生成モデルを支えるツールとワークフロー

合成データと生成モデルを実務で活用するには、以下のようなツールとワークフローが関わります。

- 物理シミュレータ：車両ダイナミクス・センサモデル・トラフィックシミュレーションを提供する基盤。
- シナリオ編集ツール：道路形状・信号・他車挙動などを GUI やスクリプトで編集できるツール。
- レンダリングパイプライン：高速なバッチレンダリングや、オンザフライのセンサシミュレーションを行うパイプライン。
- 生成モデル学習基盤：画像・動画・点群生成モデルを学習・推論するための GPU クラスターと MLOps 環境。

これらのツールについて、本書では特定の製品やプラットフォームに依存しませんが、共通する設計原則として、

- シナリオ定義（第 7 章で扱う OpenSCENARIO 的な DSL など）をコードとして管理する。
- 合成データにもデータセットスキーマ・スプリット・バージョン管理（4.6 節）を適用する。
- 合成データの生成ジョブ・学習ジョブ・評価ジョブをワークフローオーケストレータで統合管理する。

といった点を重視します。

## Closed-Loop における合成データの役割

Closed-Loop の観点では、合成データは次のような場面で特に効果を発揮します。

- 実車では危険なシナリオ（高速道路での多重衝突、急な飛び出しなど）を安全に再現し、モデルの限界を評価する。
- 実世界で頻度が極端に低いが安全上重要なシナリオ（豪雪・土砂崩れ・特殊道路インフラなど）をカバーする。
- 特定の ODD 拡張（新しい地域・道路規格）に対して、現地でのフリート導入前に予備検証を行う。

一方で、合成データだけに依存してモデルを評価・リリースすることは避けるべきです。合成データで学習・評価したモデルは、必ず現実データに基づくオフライン評価および Closed-Loop シミュレーション（第 7 章）、さらには限定条件での実車テストによって検証し、その結果をもとに合成データ生成のパラメータやシナリオ設計を更新していく必要があります。

このように、合成データと生成モデルは「現実データを置き換えるもの」ではなく、「現実データを補完し、Closed-Loop の探索範囲を広げるためのツール」として位置づけるのが、データ中心・安全志向の自動運転開発において望ましい考え方です。

