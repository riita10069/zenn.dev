# 5.7 オンラインでの継続ラベル付け・再ラベル

この節では、運用フェーズにおける継続的なラベル付けと再ラベルについて解説します。インシデント・ヒヤリハットからの優先ラベル付け、ラベルポリシー変更時の再ラベル戦略（全量 / サンプル）、フリート全体でのラベル進行管理を整理し、データ中心・Closed-Loop の観点から「運用中もラベルセットが進化し続ける前提」を考えます。

## インシデント駆動のラベル付け

オンラインモニタリングや現場からの報告で検出されたインシデントやヒヤリハットに対し、その周辺ログを優先的にラベリングキューに投入することで、安全性改善に直結するデータを素早く取り込むことができます。

## 再ラベル戦略とラベル進行管理

ラベルポリシー変更やラベリングミス発覚に伴う再ラベルは、コストが高いため戦略的に行う必要があります。Closed-Loop の観点では、重要度の高いクラスやシナリオから優先的に再ラベルし、フリート全体でのラベル進行状況をダッシュボードで管理することが有効です。

## 継続ラベリング用のデータフロー設計

運用フェーズで発生するインシデント・ヒヤリハット・異常検知イベントを、ラベリングパイプラインに自動で流し込むデータフローを設計すると、Continuous Labeling (継続ラベル付け) を現実的に運用できます。

- **オンラインモニタリングとの連携**  
  第8章で述べるオンラインモニタリング (online monitoring) や異常検知 (anomaly detection) から、「スコアが閾値を超えたイベント」をストリームとして受け取り、その周辺時間のログ（例: 前後 30 秒）を自動的にラベリングキューへ登録します。
- **メタデータの付与**  
  事件番号、日時、場所、関係する車両 ID、安全影響度などのメタデータをラベルタスクに紐づけておくことで、後から「どのインシデントに対してどのラベルを付け、どのモデル改善につながったか」を追跡できます。
- **優先度キュー (priority queue)**  
  インシデント種別や安全影響度に応じて、ラベルタスクの優先度を決定します。例えば、AEB 作動を伴うヒヤリハットは最高優先度、軽微な UI バグは低優先度といったルールです。

このようなデータフローをあらかじめ構築しておくことで、「現場で起きた事象が数週間以内に学習データへ取り込まれ、モデル更新に反映される」という Closed-Loop を実現しやすくなります。

## ポリシー変更に伴う再ラベル計画

ラベルポリシーの変更（クラスの分割・統合、境界ケースの定義変更など）は、既存データセットの再ラベル (relabeling) を必要としますが、全量再ラベルは現実的ではありません。そこで、次のような観点から再ラベル計画を立てることが多いです。

- **影響範囲の推定**  
  ポリシー変更が影響するクラス・シナリオ・ODD を特定し、その分布を既存データセット上で推定します。例えば、「駐車車両と停車車両を分離する」場合、都市部の路上駐車シーンが主な対象となるかもしれません。
- **重要度に応じた段階的再ラベル**  
  まずは安全クリティカルな領域（歩行者・二輪車周辺、交差点など）だけを再ラベルし、その効果をモデル評価で確認します。その後、必要に応じてカバレッジを広げる段階的なアプローチを取ります。
- **ルールベース変換との併用**  
  可能な部分はルールベースやモデルを用いた自動変換で対応し、人手再ラベルは境界ケースや重要シーンに集中させます。例えば、車両速度や位置に基づいて「駐車 vs 走行」を自動推定し、疑わしいケースだけを人に確認させるといった方法です。

再ラベル計画自体も、実験管理システム上でトラッキングし、「どのモデルがどのポリシーバージョンのラベルで学習されているか」を明示する必要があります。

## フリート規模でのラベル進行管理

大規模フリート (fleet) を運用している場合、継続ラベル付けと再ラベルの進行状況を管理するダッシュボードが重要になります。代表的な指標としては次のようなものがあります。

- ODD セグメント（地域・道路種別・時間帯など）ごとのラベル済みデータ量
- インシデント種別ごとのラベル完了率
- ポリシーバージョンごとのデータ量と再ラベル進行状況

これらを可視化することで、「どの領域でラベルが不足しているか」「どのインシデント種別がまだ十分にカバーされていないか」を把握できます。さらに、第6章・第7章の評価結果と突き合わせることで、「モデル性能が低い領域」と「ラベル不足の領域」を照合し、次にどこへラベリングリソースを投下すべきかを意思決定できます。

Closed-Loop の最終的な目標は、「運用で発生した現象が、数回の学習サイクルを経て安定して扱えるようになる」ことです。オンラインでの継続ラベル付けと再ラベル戦略は、その目標に向けてデータ側からボトルネックを解消していくための重要な仕組みだといえます。
