# 7.8 レポート自動生成と可視化

この節では、テストレポートの自動生成と可視化について解説します。シナリオごとの成否・メトリクスの自動集計、デザインレビュー・安全レビュー用ドキュメント生成を整理し、データ中心・Closed-Loop の観点から「評価結果を組織的意思決定につなげる」仕組みを考えます。

## なぜレポート自動生成が重要か

第 2〜7 章で述べてきたように、データ中心・Closed-Loop な開発では、膨大な数のシナリオ・データセット・モデルバージョンに対して評価を行うことになります。これらの結果を人手で集計し、スライドやドキュメントにまとめることは現実的ではありません。

レポート自動生成 (automated reporting) の目的は、

- 評価結果を一貫したフォーマットで迅速に共有すること。
- リグレッションや性能劣化を早期に検知すること。
- 安全レビューやリリース会議での意思決定を、データに基づいたものにすること。

にあります。特に、規制対応や安全認証を視野に入れると、「どのモデルバージョンをどのシナリオセットで評価し、どのような結果になったか」を長期的に保管・再現できることが求められます。

## シナリオ単位・ODD セグメント単位の集計

レポート自動生成の基本は、評価基盤から出力される生ログを、シナリオ単位・ODD セグメント単位で集計することです。典型的には、次のような指標が集計されます。

- シナリオ単位:
  - 実行回数、成功回数、失敗回数、失敗理由の分類。
  - 最小・平均・最大の安全マージン（距離・時間）。
  - 乗り心地指標（最大加速度、ジャークなど）。
- ODD セグメント単位:
  - 雨天夜間・都市高速・郊外一般道などの条件ごとの成功率。
  - インシデント・ヒヤリハットの発生頻度。
  - 特定機能（自動レーンチェンジ、右折など）における性能指標。

これらの集計結果は、第 7.6 節で述べたカバレッジ指標と組み合わせることで、「テストしている領域・していない領域」「テストしているが性能が不十分な領域」を俯瞰することができます。

## ダッシュボードと可視化のパターン

実務では、BI ツールやカスタムダッシュボードを用いて、評価結果をインタラクティブに可視化することが多いです。代表的な可視化パターンとしては以下が挙げられます。

- カバレッジマトリクス:
  - ODD セグメント（行） × 機能カテゴリ（列）のマトリクス上に、テストカバレッジと成功率を色で表示する。
  - 真っ赤なセル（カバレッジ不足・性能不足）がどこか一目で分かるようにする。
- シナリオランキング:
  - 失敗回数の多いシナリオ、改善度の大きかったシナリオ、実車インシデントと関連の深いシナリオをランキングで表示する。
  - 各シナリオから詳細ログや再生用ツールにワンクリックで遷移できるようにする。
- 時系列トレンド:
  - モデルバージョンごとの成功率・安全マージンの推移をグラフ化し、改善傾向・退行傾向を可視化する。
  - リリースバージョンと評価結果を重ね、フィールドでの KPI との相関を確認する。

これらの可視化は、「データ中心の意思決定」を組織に根付かせるための重要な要素です。特に、多職種のステークホルダー（経営層、安全チーム、運用チームなど）が参加するレビューでは、直感的に理解できる可視化が効果を発揮します。

## 安全レビュー・デザインレビュー向けドキュメント生成

シナリオベース評価や HiL 評価の結果は、安全レビュー・デザインレビュー・リリース会議などで正式なドキュメントとして共有されることが多いです。レポート自動生成基盤では、次のようなドキュメント出力を想定します。

- シナリオセットレベルのテストレポート:
  - 対象シナリオセットの定義（バージョン、ODD セグメント、選定理由）。
  - 使用したモデルバージョン・ECU 構成・シミュレーション設定。
  - 主要指標（成功率、安全マージン、インシデント件数など）の概要と、代表的な失敗ケースの一覧。
- モデルリリース評価レポート:
  - 新旧モデルの比較（オフライン指標・シミュレーション指標・HiL 指標）。
  - 性能改善の根拠となるシナリオ、逆に性能悪化が見られるシナリオ。
  - リリース可否判断に用いた基準と、その達成状況。
- 安全ケース用エビデンスパッケージ:
  - 第 7.9 節で扱うセーフティケースの要求に応じた、テスト結果・ログ・設定ファイルの束。
  - 後から再評価・再解析が可能なように、再現に必要なメタデータを含める。

これらのドキュメントは、手作業ではなく、評価結果 DB からテンプレートベースで自動生成されることが望ましいです。人間は、その上でレビュー・解釈・意思決定に集中できるようになります。

## Closed-Loop におけるレポートの役割

レポート自動生成と可視化は、Closed-Loop データエンジンにおいて「フィードバックを可視化する層」として機能します。具体的には、次のようなループを支えます。

1. シナリオベース評価・SiL・HiL・実車テストから生ログが収集される（第 7.1〜7.7 節）。
2. 生ログが評価基盤で解析され、シナリオ単位・ODD 単位の指標として集計される。
3. レポート自動生成基盤がドキュメント・ダッシュボードを出力し、関係者に共有される。
4. レポートに基づき、データ収集計画・ラベリング優先度・モデル改良方針・リリース判断などが行われる。
5. その結果として新たなモデル・データ・シナリオが生まれ、再び評価サイクルに戻ってくる。

このサイクルを高速かつ安定して回すためには、「評価結果を集計・可視化するパイプライン」自体も第 6 章のトレーニングパイプラインと同様にコード化し、テスト可能な形で管理することが重要です。
