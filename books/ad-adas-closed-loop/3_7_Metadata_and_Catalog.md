# 3.7 メタデータ管理とカタログ

この節では、メタデータ管理とデータカタログ (data catalog) について解説します。地域・天候・車種・ソフトウェアバージョン・センサー構成などの属性管理、自動タグ付けと統計情報の集約、データリネージ (data lineage) の扱いを整理します。データ中心・Closed-Loop の観点から、カタログが「データエンジンの入り口」として果たす役割を理解することが目的です。

## 属性管理とタグ付け

メタデータとして管理すべき代表的な属性には、以下のようなものがあります。

- 地理情報（国・都市・道路 ID 等）
- ODD 関連（道路種別、天候、時間帯、交通密度）
- 車種・車両世代・センサー構成・ソフトウェアバージョン
- シナリオタグ（右折、合流、歩行者飛び出しなど）

これらの属性は、収集時のメタデータ、オンボードモニタリング結果、オフライン解析やラベリングの結果などから統合的に付与されます。Closed-Loop の観点では、「どの属性に着目してデータを抽出し、どの属性単位で性能を評価するか」が明確になっているほど、カタログの価値が高まります。

属性設計の際には、「現場のエンジニアが実際に口にする分類軸」を意識することが重要です。例えば、

- 「都市高速のランプ合流」「郊外の信号なし交差点」「雪道の片側一車線」といった表現。
- 「右折時の横断歩道歩行者」「自転車の逆走」「緊急車両接近」といったシナリオ。

これらをそのままタグとして扱えるようなタクソノミを設計することで、後続のシーン検索や評価レポート作成がスムーズになります。

## 自動タグ付けと統計情報の集約

フリート規模が大きくなると、人手で全てのメタデータを付与することは不可能です。そこで、以下のような自動タグ付けや統計集約が重要になります。

- モデルやルールベース検出器を用いた天候・時間帯・シナリオの自動推定。
- テレメトリやセンサ統計から、交通密度や走行パターンの特徴を算出。
- 集約された統計情報（例: ODD セグメント別の走行時間・イベント件数）をダッシュボードとして可視化。

データ中心の観点では、これらの統計が「どの領域でデータが不足し、どの領域でモデルが弱いか」を把握するための基盤となります。Closed-Loop のサイクルを回す中で、統計に基づきデータ収集計画やラベリング優先度を更新していくことが重要です。

統計情報の集約では、単に総量を数えるだけでなく、モデル性能やインシデント率と組み合わせた「リスク重み付き指標」を導入することも有効です。例えば、

- ODD セグメントごとの走行時間に対して、インシデント件数を正規化した「インシデント率」。
- シナリオごとの発生頻度とモデル失敗率を掛け合わせた「リスクスコア」。

といった指標を用いることで、「頻度は低いがリスクが高いシナリオ」を定量的に特定し、データ収集・ラベリング・シミュレーションの優先度に反映できます。

## データリネージ（どのモデルがどのデータから学習されたか）

データリネージは、「どのデータがどのモデル・評価結果に使われたか」を追跡するための情報です。安全クリティカルな自動運転領域では、データリネージの管理が特に重要です。

- 各モデルアーティファクトに対して、学習に使用したデータセットバージョン ID をメタデータとして付与する。
- データセットバージョン ID と実際の Drive / Scene / Frame の集合との対応をカタログ上で管理する。
- 評価結果にもデータセットバージョンとモデルバージョンの両方を紐付ける。

Closed-Loop の観点では、インシデントや性能低下が発生した際に、「どのデータに問題があり、どのモデルに波及しているか」を迅速に特定し、必要に応じて再ラベリング・再学習・ロールバックを行えることが重要です。

データリネージを実現するためには、

- データセット定義と実際の Drive / Scene / Frame の集合を一対一に対応付ける ID を持つ。
- 実験管理ツールやモデルレジストリに、このデータセット ID を必ず記録する。
- 評価レポートにも、モデル ID・データセット ID・スキーマバージョンなどを紐付ける。

といったルールを徹底する必要があります。これにより、「あるインシデントが発生したとき、そのとき搭載されていたモデルがどのデータから学習されていたか」を追跡し、そのデータセットに含まれる Drive / Scene へと辿る Closed-Loop を形成できます。

