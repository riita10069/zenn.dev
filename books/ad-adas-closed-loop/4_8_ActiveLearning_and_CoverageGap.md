---
title: "4.8 アクティブラーニングとカバレッジギャップ把握"
---

# 4.8 アクティブラーニングとカバレッジギャップ把握

この節では、アクティブラーニング (active learning) とカバレッジギャップ把握について解説します。モデル不確実性・異常スコアを用いたデータ選択、ODD セグメントごとの指標とギャップ可視化、レアシナリオクラスターの自動発見などを整理し、データ中心・Closed-Loop の観点から「どのデータを追加で集めるべきか」を定量的に決める枠組みを考えます。

## モデル不確実性・異常スコアを用いたデータ選択

既存モデルの予測確率やエントロピー、ドロップアウトベースの不確実性推定、異常検知モデルのスコアなどを用いて、「モデルが苦手としているサンプル」を自動的に抽出することができます。これらを優先的にラベリング・再学習に回すことで、効率の良い Closed-Loop を構築できます。

具体的な不確実性指標としては、次のようなものが一般的です。

- 最大クラス確率の低さ（confidence スコア）。
- 予測分布のエントロピー（高いほど不確実）。
- Monte Carlo Dropout や Deep Ensemble による予測分散。
- Out-of-Distribution (OOD) 検知モデルによる異常スコア。

Perception タスクでは、検出ボックスごとのスコアやマスクの信頼度、セマンティックセグメンテーションのピクセルごとの不確実性を集約して、フレーム単位・シーン単位の指標を計算します。Prediction / Planning タスクでは、複数予測軌道間の分散や、コリジョン確率推定モデルの出力などを用いて、「モデルが判断に迷っているシーン」を特定します。

アクティブラーニング戦略としては、

- Uncertainty Sampling：不確実性スコアの高いサンプルを優先的に選択する。
- Margin Sampling：トップ 2 クラスのスコア差が小さいサンプルを選択する。
- Diversity-aware Sampling：不確実性だけでなく、Embedding 空間上の多様性も考慮し、似たサンプルばかり選ばないようにする。

などの手法が知られています。自動運転では、シーンレベルの多様性を確保するため、フレーム単位ではなくシーン単位でサンプリングを行うことが多いです。

アクティブラーニングの実装には、Python 向けのライブラリ（modAL, BAAL, ALiPy 等）を参考にすることができますが、多くの場合は自社のデータセット構造や MLOps 基盤に合わせてカスタムのアクティブラーニングパイプラインを構築します。重要なのは、選択ポリシーをコードとして明示し、実験管理ツールと連携させて「どのラウンドでどのサンプルを新規ラベリングしたか」を追跡できるようにすることです。

## ODD セグメントごとのギャップ可視化とレアシナリオクラスター

ODD セグメントごとにデータ量と性能指標を可視化し、「データ量が少ないのか、データ量は十分だが性能が出ていないのか」を切り分けます。また、ログマイニングやクラスタリングにより、レアシナリオのクラスターを自動発見し、優先度を付けてラベリング・再学習対象とすることもできます。

カバレッジギャップ把握のためには、

- ODD セグメント別のデータ量（シーン数・フレーム数・オブジェクトインスタンス数）を定期的に集計する。
- 同じセグメント別に Perception / Prediction / Planning 指標を可視化する。
- データ量と性能を並べて表示し、「どこが真のデータ不足で、どこがモデリング上の問題か」を切り分ける。

といったダッシュボードを整備することが有効です。BI ツール（Looker, Tableau, Superset 等）やカスタムの Web ダッシュボードを用いて、ODD セグメント × シナリオ × 指標のヒートマップを表示すると、カバレッジギャップが直感的に把握できます。

レアシナリオクラスターの自動発見には、

- シーンごとの特徴量（Embedding、テレメトリ統計、マップ情報など）をベクトル化する。
- 次元削減（PCA, t-SNE, UMAP 等）やクラスタリング（k-means, DBSCAN, HDBSCAN 等）を適用する。
- クラスタごとの代表シーンを可視化し、シナリオ名・リスクレベル・優先度を人間が付与する。

といった手順を取ります。これにより、人間が事前に定義していなかった「潜在シナリオ」（例: 特定の交差点形状や交通パターン）が浮かび上がり、ラベルポリシーやテストシナリオの設計にフィードバックできます。

## Closed-Loop におけるアクティブラーニング・カバレッジ管理の位置づけ

Closed-Loop の観点では、アクティブラーニングとカバレッジギャップ把握は、次のようなループの中心に位置します。

1. 現行モデルをフリートログやシミュレーションに適用し、不確実性・異常スコアを計算する。
2. ODD セグメント別・シナリオ別に指標を集計し、カバレッジギャップと性能ギャップを可視化する。
3. アクティブラーニングポリシーに従って、ラベリング候補のシーンを選択する。
4. ラベリング済みデータをデータセットに追加し、再学習・再評価を行う。
5. 新しいモデルを実運用やシミュレーションにデプロイし、再び 1 に戻る。

このループを効率よく回すためには、

- 不確実性・異常スコアの計算をオンラインまたはバッチで継続的に実行できるようにする。
- シーン検索 UI（4.7 節）と連携し、人間が候補シーンを確認・調整できるようにする。
- データセット管理・実験管理ツールと連携し、各アクティブラーニングラウンドでの追加データと性能変化をトレースできるようにする。

といった基盤整備が必要です。特定のライブラリや製品に依存する必要はなく、上記の考え方を満たす範囲で、自組織の既存インフラ（データレイク・ジョブスケジューラ・BI ツール）を最大限活用するのが現実的です。

