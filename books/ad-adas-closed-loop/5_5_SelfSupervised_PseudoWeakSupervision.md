# 5.5 自己教師あり・擬似ラベル・弱教師あり

この節では、自己教師あり学習 (self-supervised learning)、擬似ラベル (pseudo-labeling)、弱教師あり学習 (weak supervision) を自動運転ラベリングにどう活用するかについて解説します。ネットワーク出力を教師とした pseudo-labeling、ルール・シミュレーション・マップ情報を組み合わせた弱教師あり、ラベルノイズとロバスト学習を整理し、データ中心・Closed-Loop の観点から「ラベルコストと性能のトレードオフ」を考えます。

## Pseudo-labeling と弱教師あり

ラベルが存在しない大規模データに対して、既存モデルの出力やルールベースの判定を用いて擬似ラベルを生成し、学習に利用する手法は、ラベルコスト削減の有力な手段です。HD マップ、車両制御ログ、シミュレーション結果なども弱教師として活用できます。

## ラベルノイズとロバスト学習

擬似ラベルや弱教師ありの利用では、ラベルノイズが避けられません。Closed-Loop の観点では、ノイズを前提としたロバスト学習（例: 信頼度に応じた重み付け、ノイズロバスト損失関数、クリーンサブセットの抽出）と、人手ラベルとの組み合わせ設計が重要です。

## 自己教師あり表現学習と自動運転データ

自己教師あり学習 (self-supervised learning) では、ラベルを用いずに入力データ自身からプリテキストタスク (pretext task) を構成し、表現 (representation) を学習します。自動運転向けには、以下のようなタスクがよく用いられます。

- 時系列一貫性に基づくコントラスト学習（SimCLR/BYOL 系の手法をマルチフレームに拡張）
- 未来フレーム予測やビデオマスキング (masked video modeling)
- マルチビュー幾何制約を利用した深度推定・自己位置推定

こうして学習した表現を初期重みとして用いることで、限られたラベル付きデータでも高い性能を発揮しやすくなります。公開研究では、車載カメラ動画に対して自己教師あり学習を行った後に、物体検出やセマンティックセグメンテーションにファインチューニングすることで、ラベル付きデータ量を 1/2〜1/4 に削減しても同等精度を達成したと報告されているものもあります。

ラベリングの観点から見ると、自己教師あり学習は「ラベルを増やさずに性能を上げる手段」として、Closed-Loop の中で検討すべき重要な選択肢です。特に、ラベル作成が極めて高コストな 3D セグメンテーションや行動予測タスクにおいて有効です。

## 擬似ラベル利用時の設計指針

擬似ラベル (pseudo label) を用いる際には、どのサンプルをどのような重みで学習に使うかが重要になります。代表的な設計指針を挙げます。

- **信頼度しきい値 (confidence thresholding)**  
  モデルの出力スコアが一定以上のサンプルのみを擬似ラベルとして採用します。FixMatch などの半教師あり学習手法では、0.95 など比較的高い閾値を用いることが多いです。自動運転では安全性が重要なため、より高い閾値を採用し、「確信度の高い pseudo label だけを使う」戦略が好まれます。
- **クラスバランスの制御**  
  擬似ラベルは頻度の高いクラスに偏りがちです。クラス分布をモニタリングし、長尾クラスが全く pseudo label に現れていない場合は、アクティブラーニングなどで人手ラベルを追加する必要があります。
- **教師モデルと生徒モデルの分離**  
  教師モデル (teacher) と生徒モデル (student) を分け、教師モデルは一定期間更新しない、もしくは Exponential Moving Average (EMA) でスムージングすることで、自己強化的な崩壊を防ぎます。

Closed-Loop の観点では、擬似ラベルで学習したモデルをオフライン評価・シミュレーションで検証し、特定のシナリオで劣化が見られる場合には、そのシナリオのサンプルを人手ラベルに切り替える・追加ラベルする、といったフィードバックループを構築します。

## 弱教師ありの情報源と運用

弱教師あり学習 (weak supervision) では、HD マップやルールベース、シミュレーションログなど、ノイズを含むラベル源を活用します。自動運転文脈で代表的な情報源は次の通りです。

- **HD マップに基づくラベル**  
  走行軌跡とマップ上の車線・停止線・横断歩道などを重ね合わせることで、どのレーンを走行していたか、信号や標識の存在などを自動ラベルとして付与できます。
- **車両制御ログ・CAN 信号**  
  AEB 作動やステアリング角の急変などをトリガーとして、「ヒヤリハット候補」「急制動シーン」のラベルを付けることができます。
- **ルールベース・シミュレーション**  
  簡易物理モデルやルールベースエージェントを用いたシミュレーション結果を弱教師として用い、現実データに対する判定の参考にします。

ただし、これらの情報源はいずれも誤りや欠落を含みます。Snorkel などのフレームワークが提案するように、複数の弱ラベルを統合して潜在的な真ラベルを推定するアプローチや、信頼度に応じた重み付けが必要になります。

Closed-Loop の運用では、弱教師ありでラベル付けしたデータのうち、モデルのエラーが多い部分を人手ラベルに置き換えていく、いわば「粗いラベルから精密ラベルへの段階的アップグレード」を設計することが重要です。これにより、限られたラベリング予算を安全クリティカルな領域に集中させつつ、大量のデータを有効活用できます。
